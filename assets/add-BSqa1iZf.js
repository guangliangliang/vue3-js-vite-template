import{_ as L,I as T,p as V,r as U,a as x,N as P,J as X,k as w,w as t,b as u,u as z,o as g,d as r,z as A,j as E,f as D,P as J,c as K,Q,E as y}from"./index-BaJaAyi_.js";import{g as G,u as H,c as W}from"./user-BrZLhI01.js";import{u as Y}from"./user-CJb-cpVL.js";import"./role-Dxqyi0J-.js";const Z={isMobile(f=!0,c="请输入手机号"){const i=/^1[3-9]\d{9}$/;return function(a,m,s){if(f){if(m){if(!i.test(String(m)))return s(new Error("请输入正确的手机号"))}else return s(new Error(c));return s()}if(m){if(!i.test(String(m)))return s(new Error("请输入正确的手机号"))}else return s();return s()}},isIdCard(){const f=/^[1-9]\d{5}(18|19|20)?\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])\d{3}[\dXx]$/;return function(c,i,a){if(i){if(!f.test(i))return a(new Error("请输入正确的身份证号"))}else return a(new Error("请输入身份证号"));return a()}}},h=["src"],ee={__name:"add",setup(f){const c=T(),i=z(),a=Y(),m=c.params.id,s=V(()=>!!m),R=V(()=>a.roles);window.userStore=a;const b=U(),_=U(),e=x({sex:"男",name:"",avatar:"",mobile:"",password:"",role_ids:[]}),I=x({name:[{required:!0,message:"请输入用户姓名",trigger:"blur"}],mobile:[{required:!0,validator:Z.isMobile(),trigger:"blur"}],password:[{required:!0,message:"请输入默认密码",trigger:"blur"}],role_ids:[{required:!0,message:"请选择用户角色",trigger:"change"}]}),C={"X-TOKEN":P()},S=async()=>{const l=await G(`${m}`);console.log(l,"infoinfo"),Object.assign(e,l.data)},B=l=>{e.avatar=l.data.url},k=(l,o)=>{_.value.clearFiles();const p=l[0];p.uid=Q(),_.value.handleStart(p);const d=o[0].raw;e.avatar=URL.createObjectURL(d),_.value.submit()},N=()=>{b.value.validate(async l=>{l&&(s.value?(await H(e),y.success("编辑成功"),a.user.id===e.id&&a.getUser()):(await W(e),y.success("添加成功")),i.back())})};return X(()=>{s.value&&S()}),(l,o)=>{const p=u("el-input"),d=u("el-form-item"),v=u("el-radio"),q=u("el-radio-group"),F=u("o-select"),M=u("BaseIcon"),O=u("el-upload"),$=u("el-form"),j=u("o-form-wrap");return g(),w(j,{title:"用户管理",onConfirm:N},{default:t(()=>[r($,{ref_key:"ruleForm",ref:b,class:"form-w-70",model:e,rules:I,"label-position":"top"},{default:t(()=>[r(d,{label:"手机号",prop:"mobile"},{default:t(()=>[r(p,{modelValue:e.mobile,"onUpdate:modelValue":o[0]||(o[0]=n=>e.mobile=n),placeholder:"请输入手机号",disabled:s.value},null,8,["modelValue","disabled"])]),_:1}),r(d,{label:"姓名",prop:"name"},{default:t(()=>[r(p,{modelValue:e.name,"onUpdate:modelValue":o[1]||(o[1]=n=>e.name=n),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),s.value?A("",!0):(g(),w(d,{key:0,label:"默认密码",prop:"password"},{default:t(()=>[r(p,{modelValue:e.password,"onUpdate:modelValue":o[2]||(o[2]=n=>e.password=n),type:"password",placeholder:"请输入默认密码"},null,8,["modelValue"])]),_:1})),r(d,{label:"性别",prop:"sex"},{default:t(()=>[r(q,{modelValue:e.sex,"onUpdate:modelValue":o[3]||(o[3]=n=>e.sex=n)},{default:t(()=>[r(v,{label:"男"},{default:t(()=>o[5]||(o[5]=[E("男")])),_:1,__:[5]}),r(v,{label:"女"},{default:t(()=>o[6]||(o[6]=[E("女")])),_:1,__:[6]})]),_:1},8,["modelValue"])]),_:1}),r(d,{label:"所属角色：",prop:"role_ids"},{default:t(()=>[r(F,{modelValue:e.role_ids,"onUpdate:modelValue":o[4]||(o[4]=n=>e.role_ids=n),multiple:"",options:R.value,"option-key":"role_option",placeholder:"请选择所属角色"},null,8,["modelValue","options"])]),_:1}),r(d,{label:"用户头像："},{default:t(()=>[r(O,{ref_key:"upload",ref:_,class:"upload-wrapper",action:`${D(J)}/file/upload`,headers:C,limit:1,"show-file-list":!1,"on-success":B,"on-exceed":k},{default:t(()=>[e.avatar?(g(),K("img",{key:0,src:e.avatar,class:"avatar"},null,8,h)):(g(),w(M,{key:1,icon:"Plus"}))]),_:1},8,["action"])]),_:1})]),_:1},8,["model","rules"])]),_:1})}}},ae=L(ee,[["__scopeId","data-v-26513c47"]]);export{ae as default};
